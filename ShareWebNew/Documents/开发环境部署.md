# 开发环境部署

1.  首先确保本地安装了`NodeJS`和`npm`。

    使用`npm install -g <package>`全局安装`gulp`、`webpack`、`typings`、`mocha`。 

    > 1. `npm` [教程](https://docs.npmjs.com/)。

2. 安装依赖  
    在`ShareWebNew`目录下，执行`npm install`安装依赖。

    该命令会从`package.json`中读取`dependicies`和`devDependicies`依赖并安装。

    模块安装在`node_modules`目录下。

    > 1. node模块的[查找规则](https://nodejs.org/api/modules.html#modules_modules)

    在`ShareWebNew`目录下，执行`typings install`安装`typings`。
    
    和`npm`类似，`typings`命令从`typings.json`中读取配置并安装。
    
    安装结果会生成`typings`目录

    > 1. `typings`是TypeScript的接口定义管理工具，具体参考[文档](https://github.com/typings/typings/blob/master/docs/commands.md)

3. **请充分理解`ShareWebNew`下各个模块之间的依赖关系。**
    > 1. [总体架构.md](AnyShare://Web小组/架构设计/0. 总体架构.md)

4. 在各个子模块下执行`gulp`，先完成基本构建。然后在`ShareWebClient`或`ShareWebMobile`下执行`webpack --watch`
    
    > 构建过程中会用到这些配置文件：  
    > 1. [gulp](http://gulpjs.com/) 配置：`gulpfile.js`  
    > 2. [webpack](http://webpack.github.io/docs/) 配置：`webpack.config.js`  
    > 3. [TypeScript](http://www.typescriptlang.org/) 配置：`tsconfig.json`  
    > 4. [Babel](https://babeljs.io/) 配置：`.babelrc`  
        注意： 由于babel插件路径查找问题，`.babelrc`在`ShareWebNew`目录下  

5. nginx配置

    按如下示例配置：

    ```
    server {
        # 要监听的端口
        listen 800;

        if ($http_user_agent ~* mobile) {
            # 移动端本地代码根路径
            set $root "/Users/mao.zhengyang/ShareWeb/ShareWebMobile";
        }

        if ($http_user_agent !~* mobile) {
            # 桌面端本地代码根路径
            set $root "/Users/mao.zhengyang/ShareWeb/ShareWebClient";
        }

        root $root;

        index index.html;
    }
    ```
